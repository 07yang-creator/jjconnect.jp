<!doctype html>
<html lang="en-US" class="no-js" itemtype="https://schema.org/WebPage" itemscope>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1">
<title>Admin Dashboard | JJConnect</title>
<meta name="description" content="JJConnect Admin Dashboard - Manage users, content, and system settings.">
<link rel="stylesheet" href="navbar.css">
<script>document.documentElement.classList.remove( 'no-js' );</script>
<style id='kadence-global-inline-css'>
/* Kadence Base CSS Variables */
:root{
    --global-palette1:#2B6CB0;
    --global-palette2:#215387;
    --global-palette3:#1A202C;
    --global-palette4:#2D3748;
    --global-palette5:#4A5568;
    --global-palette6:#718096;
    --global-palette7:#EDF2F7;
    --global-palette8:#F7FAFC;
    --global-palette9:#ffffff;
    --global-palette9rgb:255, 255, 255;
    --global-palette-highlight:var(--global-palette1);
    --global-palette-highlight-alt:var(--global-palette2);
    --global-palette-btn-bg:var(--global-palette1);
    --global-palette-btn-bg-hover:var(--global-palette2);
    --global-palette-btn:var(--global-palette9);
    --global-palette-btn-hover:var(--global-palette9);
    --global-body-font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen-Sans,Ubuntu,Cantarell,"Helvetica Neue",sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
    --global-heading-font-family:inherit;
    --sidebar-width: 260px;
    --header-height: 64px;
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: var(--global-body-font-family);
    font-size: 15px;
    line-height: 1.6;
    color: var(--global-palette4);
    background: var(--global-palette8);
    overflow-x: hidden;
}

/* Admin Layout */
.admin-wrapper {
    display: flex;
    min-height: 100vh;
}

/* Header */
.admin-header {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    height: var(--header-height);
    background: var(--global-palette9);
    border-bottom: 1px solid var(--global-palette7);
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 2rem;
    z-index: 100;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
}

.admin-header h1 {
    font-size: 20px;
    font-weight: 700;
    color: var(--global-palette3);
}

.admin-header-right {
    display: flex;
    align-items: center;
    gap: 1.5rem;
}

.user-info {
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

.user-avatar {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background: var(--global-palette1);
    color: var(--global-palette9);
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    font-size: 14px;
}

.user-name {
    font-weight: 600;
    color: var(--global-palette3);
}

.logout-btn {
    padding: 0.5rem 1rem;
    background: transparent;
    border: 1px solid var(--global-palette7);
    border-radius: 6px;
    color: var(--global-palette4);
    font-size: 14px;
    cursor: pointer;
    transition: all 0.3s ease;
}

.logout-btn:hover {
    background: var(--global-palette7);
    color: var(--global-palette3);
}

/* Sidebar */
.admin-sidebar {
    position: fixed;
    top: var(--header-height);
    left: 0;
    width: var(--sidebar-width);
    height: calc(100vh - var(--header-height));
    background: var(--global-palette9);
    border-right: 1px solid var(--global-palette7);
    padding: 1.5rem 0;
    overflow-y: auto;
    z-index: 90;
}

.sidebar-menu {
    list-style: none;
}

.sidebar-menu-item {
    margin-bottom: 0.25rem;
}

.sidebar-menu-link {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.875rem 1.5rem;
    color: var(--global-palette4);
    text-decoration: none;
    font-weight: 500;
    transition: all 0.3s ease;
    cursor: pointer;
}

.sidebar-menu-link:hover {
    background: var(--global-palette8);
    color: var(--global-palette3);
}

.sidebar-menu-link.active {
    background: var(--global-palette1);
    color: var(--global-palette9);
    border-right: 3px solid var(--global-palette2);
}

.sidebar-icon {
    font-size: 18px;
    width: 20px;
    text-align: center;
}

/* Main Content */
.admin-main {
    margin-left: var(--sidebar-width);
    margin-top: var(--header-height);
    flex: 1;
    padding: 2rem;
    min-height: calc(100vh - var(--header-height));
}

.content-section {
    display: none;
}

.content-section.active {
    display: block;
}

.section-header {
    margin-bottom: 2rem;
}

.section-header h2 {
    font-size: 28px;
    font-weight: 700;
    color: var(--global-palette3);
    margin-bottom: 0.5rem;
}

.section-header p {
    color: var(--global-palette5);
    font-size: 14px;
}

/* Stats Cards */
.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
}

.stat-card {
    background: var(--global-palette9);
    border-radius: 12px;
    padding: 1.5rem;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    border: 1px solid var(--global-palette7);
}

.stat-card h3 {
    font-size: 14px;
    font-weight: 600;
    color: var(--global-palette5);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 0.5rem;
}

.stat-card .stat-value {
    font-size: 32px;
    font-weight: 700;
    color: var(--global-palette3);
}

/* Table Styles */
.table-container {
    background: var(--global-palette9);
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    border: 1px solid var(--global-palette7);
    overflow: hidden;
}

.table-header {
    padding: 1.5rem;
    border-bottom: 1px solid var(--global-palette7);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.table-header h3 {
    font-size: 18px;
    font-weight: 700;
    color: var(--global-palette3);
}

.btn {
    padding: 0.625rem 1.25rem;
    border: none;
    border-radius: 8px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    text-decoration: none;
    display: inline-block;
}

.btn-primary {
    background: var(--global-palette-btn-bg);
    color: var(--global-palette-btn);
    box-shadow: 0 2px 8px rgba(43, 108, 176, 0.2);
}

.btn-primary:hover {
    background: var(--global-palette-btn-bg-hover);
    box-shadow: 0 4px 12px rgba(43, 108, 176, 0.3);
    transform: translateY(-2px);
}

.btn-secondary {
    background: var(--global-palette7);
    color: var(--global-palette4);
}

.btn-secondary:hover {
    background: var(--global-palette6);
    color: var(--global-palette9);
}

.btn-danger {
    background: #E53E3E;
    color: var(--global-palette9);
}

.btn-danger:hover {
    background: #C53030;
}

.btn-sm {
    padding: 0.375rem 0.75rem;
    font-size: 13px;
}

table {
    width: 100%;
    border-collapse: collapse;
}

thead {
    background: var(--global-palette8);
}

th {
    padding: 1rem 1.5rem;
    text-align: left;
    font-size: 13px;
    font-weight: 700;
    color: var(--global-palette4);
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

td {
    padding: 1rem 1.5rem;
    border-top: 1px solid var(--global-palette7);
    color: var(--global-palette4);
}

tr:hover {
    background: var(--global-palette8);
}

.badge {
    display: inline-block;
    padding: 0.25rem 0.75rem;
    border-radius: 12px;
    font-size: 12px;
    font-weight: 600;
    text-transform: uppercase;
}

.badge-admin {
    background: #9F7AEA;
    color: var(--global-palette9);
}

.badge-editor {
    background: #4299E1;
    color: var(--global-palette9);
}

.badge-viewer {
    background: var(--global-palette6);
    color: var(--global-palette9);
}

.badge-active {
    background: #48BB78;
    color: var(--global-palette9);
}

.badge-inactive {
    background: #FC8181;
    color: var(--global-palette9);
}

.action-buttons {
    display: flex;
    gap: 0.5rem;
}

/* Form Styles */
.form-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
}

.form-group {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.form-group label {
    font-weight: 600;
    font-size: 14px;
    color: var(--global-palette4);
}

.form-group input,
.form-group select,
.form-group textarea {
    padding: 0.75rem;
    border: 2px solid var(--global-palette7);
    border-radius: 8px;
    font-size: 15px;
    font-family: var(--global-body-font-family);
    color: var(--global-palette3);
    background: var(--global-palette9);
    transition: all 0.3s ease;
}

.form-group input:focus,
.form-group select:focus,
.form-group textarea:focus {
    outline: none;
    border-color: var(--global-palette1);
    box-shadow: 0 0 0 3px rgba(43, 108, 176, 0.1);
}

.form-group textarea {
    min-height: 120px;
    resize: vertical;
}

/* Settings Cards */
.settings-grid {
    display: grid;
    gap: 1.5rem;
}

.settings-card {
    background: var(--global-palette9);
    border-radius: 12px;
    padding: 2rem;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    border: 1px solid var(--global-palette7);
}

.settings-card h3 {
    font-size: 20px;
    font-weight: 700;
    color: var(--global-palette3);
    margin-bottom: 1rem;
}

.settings-card p {
    color: var(--global-palette5);
    font-size: 14px;
    margin-bottom: 1.5rem;
}

/* Animations */
@keyframes slideIn {
    from {
        transform: translateX(400px);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}

@keyframes slideOut {
    from {
        transform: translateX(0);
        opacity: 1;
    }
    to {
        transform: translateX(400px);
        opacity: 0;
    }
}

/* Responsive */
@media all and (max-width: 1024px) {
    :root {
        --sidebar-width: 220px;
    }
    
    .admin-main {
        padding: 1.5rem;
    }
}

@media all and (max-width: 768px) {
    .admin-header {
        padding: 0 1rem;
    }
    
    .admin-header h1 {
        font-size: 16px;
    }
    
    .admin-sidebar {
        transform: translateX(-100%);
        transition: transform 0.3s ease;
    }
    
    .admin-sidebar.mobile-open {
        transform: translateX(0);
    }
    
    .admin-main {
        margin-left: 0;
        padding: 1rem;
    }
    
    .table-container {
        overflow-x: auto;
    }
    
    table {
        min-width: 600px;
    }
    
    .user-name {
        display: none;
    }
}
</style>
</head>
<body class="admin-page">
<script src="navbar.js"></script>
<style>
/* Hide any existing headers */
#masthead, #mobile-header {
    display: none !important;
}
</style>
<!-- Header -->
<header class="admin-header">
    <h1>JJConnect Admin Dashboard</h1>
    <div class="admin-header-right">
        <div class="user-info">
            <div class="user-avatar">AD</div>
            <span class="user-name">Admin User</span>
        </div>
        <button class="logout-btn" onclick="handleLogout()">Logout</button>
    </div>
</header>

<!-- Developer Debug Panel (Remove in production) -->
<div id="debug-panel" style="position: fixed; bottom: 20px; right: 20px; background: var(--global-palette3); color: var(--global-palette9); padding: 1rem; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.3); z-index: 1000; font-size: 13px; min-width: 250px;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem;">
        <strong>ğŸ”§ å¼€å‘è€…è°ƒè¯•é¢æ¿</strong>
        <button onclick="document.getElementById('debug-panel').style.display='none'" style="background: transparent; border: none; color: var(--global-palette9); cursor: pointer; font-size: 18px; padding: 0; line-height: 1;">Ã—</button>
    </div>
    <div style="margin-bottom: 0.75rem;">
        <label style="display: block; margin-bottom: 0.25rem; font-size: 12px;">åˆ‡æ¢ç”¨æˆ·è§’è‰²:</label>
        <select id="role-switcher" onchange="switchRole(this.value)" style="width: 100%; padding: 0.5rem; border-radius: 6px; border: none; font-size: 13px;">
            <option value="2">ç®¡ç†å‘˜ (Admin)</option>
            <option value="1">ç¼–è¾‘è€… (Editor)</option>
            <option value="0">è®¿å®¢ (Viewer)</option>
        </select>
    </div>
    <div style="font-size: 11px; color: rgba(255,255,255,0.7); border-top: 1px solid rgba(255,255,255,0.2); padding-top: 0.5rem;">
        å½“å‰æƒé™: <span id="current-role-display" style="font-weight: 600;">Admin</span>
    </div>
</div>

<!-- Sidebar -->
<aside class="admin-sidebar">
    <ul class="sidebar-menu">
        <li class="sidebar-menu-item">
            <a class="sidebar-menu-link active" data-section="users">
                <span class="sidebar-icon">ğŸ‘¥</span>
                <span>ç”¨æˆ·ç®¡ç†</span>
            </a>
        </li>
        <li class="sidebar-menu-item">
            <a class="sidebar-menu-link" data-section="content">
                <span class="sidebar-icon">ğŸ“</span>
                <span>å†…å®¹å‘å¸ƒ</span>
            </a>
        </li>
        <li class="sidebar-menu-item">
            <a class="sidebar-menu-link" data-section="settings">
                <span class="sidebar-icon">âš™ï¸</span>
                <span>ç³»ç»Ÿè®¾ç½®</span>
            </a>
        </li>
        <li class="sidebar-menu-item">
            <a class="sidebar-menu-link" data-section="submissions">
                <span class="sidebar-icon">ğŸ“®</span>
                <span>æäº¤ç®¡ç†</span>
            </a>
        </li>
    </ul>
</aside>

<!-- Main Content -->
<main class="admin-main">
    <!-- Users Section -->
    <section id="users-section" class="content-section active">
        <div class="section-header">
            <h2>ç”¨æˆ·ç®¡ç†</h2>
            <p>ç®¡ç†ç³»ç»Ÿç”¨æˆ·ã€æƒé™å’Œè®¿é—®æ§åˆ¶</p>
        </div>
        
        <div class="stats-grid">
            <div class="stat-card">
                <h3>æ€»ç”¨æˆ·æ•°</h3>
                <div class="stat-value">247</div>
            </div>
            <div class="stat-card">
                <h3>ç®¡ç†å‘˜</h3>
                <div class="stat-value">5</div>
            </div>
            <div class="stat-card">
                <h3>ç¼–è¾‘è€…</h3>
                <div class="stat-value">18</div>
            </div>
            <div class="stat-card">
                <h3>è®¿å®¢</h3>
                <div class="stat-value">224</div>
            </div>
        </div>
        
        <div class="table-container">
            <div class="table-header">
                <h3>ç”¨æˆ·åˆ—è¡¨</h3>
                <button class="btn btn-primary" onclick="handleAddUser()">+ æ·»åŠ ç”¨æˆ·</button>
            </div>
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>ç”¨æˆ·å</th>
                        <th>é‚®ç®±</th>
                        <th>æƒé™ç­‰çº§</th>
                        <th>çŠ¶æ€</th>
                        <th>æ³¨å†Œæ—¶é—´</th>
                        <th>æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>#001</td>
                        <td>admin_user</td>
                        <td>admin@jjconnect.jp</td>
                        <td><span class="badge badge-admin">Admin</span></td>
                        <td><span class="badge badge-active">Active</span></td>
                        <td>2025-01-15</td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn btn-secondary btn-sm" onclick="handleEditUser(1)">ç¼–è¾‘</button>
                                <button class="btn btn-danger btn-sm" onclick="handleDeleteUser(1)">åˆ é™¤</button>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>#002</td>
                        <td>editor_john</td>
                        <td>john@jjconnect.jp</td>
                        <td><span class="badge badge-editor">Editor</span></td>
                        <td><span class="badge badge-active">Active</span></td>
                        <td>2025-01-20</td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn btn-secondary btn-sm" onclick="handleEditUser(2)">ç¼–è¾‘</button>
                                <button class="btn btn-danger btn-sm" onclick="handleDeleteUser(2)">åˆ é™¤</button>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>#003</td>
                        <td>viewer_sarah</td>
                        <td>sarah@jjconnect.jp</td>
                        <td><span class="badge badge-viewer">Viewer</span></td>
                        <td><span class="badge badge-active">Active</span></td>
                        <td>2025-02-01</td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn btn-secondary btn-sm" onclick="handleEditUser(3)">ç¼–è¾‘</button>
                                <button class="btn btn-danger btn-sm" onclick="handleDeleteUser(3)">åˆ é™¤</button>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>#004</td>
                        <td>editor_mike</td>
                        <td>mike@jjconnect.jp</td>
                        <td><span class="badge badge-editor">Editor</span></td>
                        <td><span class="badge badge-inactive">Inactive</span></td>
                        <td>2025-01-28</td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn btn-secondary btn-sm" onclick="handleEditUser(4)">ç¼–è¾‘</button>
                                <button class="btn btn-danger btn-sm" onclick="handleDeleteUser(4)">åˆ é™¤</button>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>#005</td>
                        <td>viewer_lisa</td>
                        <td>lisa@jjconnect.jp</td>
                        <td><span class="badge badge-viewer">Viewer</span></td>
                        <td><span class="badge badge-active">Active</span></td>
                        <td>2025-02-05</td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn btn-secondary btn-sm" onclick="handleEditUser(5)">ç¼–è¾‘</button>
                                <button class="btn btn-danger btn-sm" onclick="handleDeleteUser(5)">åˆ é™¤</button>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </section>

    <!-- Content Section -->
    <section id="content-section" class="content-section">
        <div class="section-header">
            <h2>å†…å®¹å‘å¸ƒ</h2>
            <p>åˆ›å»ºå’Œç®¡ç†ç½‘ç«™å†…å®¹ã€æ–‡ç« å’Œåª’ä½“</p>
        </div>
        
        <div class="table-container">
            <div class="table-header">
                <h3>å‘å¸ƒæ–°å†…å®¹</h3>
            </div>
            <div style="padding: 2rem;">
                <form class="form-grid" onsubmit="handlePublishContent(event)">
                    <div class="form-group">
                        <label for="content-title">æ ‡é¢˜</label>
                        <input type="text" id="content-title" name="title" placeholder="è¾“å…¥å†…å®¹æ ‡é¢˜" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="content-category">åˆ†ç±»</label>
                        <select id="content-category" name="category" required>
                            <option value="">é€‰æ‹©åˆ†ç±»</option>
                            <option value="news">æ–°é—»</option>
                            <option value="blog">åšå®¢</option>
                            <option value="announcement">å…¬å‘Š</option>
                            <option value="event">æ´»åŠ¨</option>
                        </select>
                    </div>
                    
                    <div class="form-group" style="grid-column: 1 / -1;">
                        <label for="content-body">å†…å®¹</label>
                        <textarea id="content-body" name="body" placeholder="è¾“å…¥å†…å®¹æ­£æ–‡" required></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="content-author">ä½œè€…</label>
                        <input type="text" id="content-author" name="author" placeholder="ä½œè€…åç§°" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="content-status">å‘å¸ƒçŠ¶æ€</label>
                        <select id="content-status" name="status" required>
                            <option value="draft">è‰ç¨¿</option>
                            <option value="published">å·²å‘å¸ƒ</option>
                            <option value="scheduled">å®šæ—¶å‘å¸ƒ</option>
                        </select>
                    </div>
                    
                    <div style="grid-column: 1 / -1;">
                        <button type="submit" class="btn btn-primary">å‘å¸ƒå†…å®¹</button>
                        <button type="button" class="btn btn-secondary" style="margin-left: 1rem;" onclick="handleSaveDraft()">ä¿å­˜è‰ç¨¿</button>
                    </div>
                </form>
            </div>
        </div>
        
        <div class="table-container" style="margin-top: 2rem;">
            <div class="table-header">
                <h3>å·²å‘å¸ƒå†…å®¹</h3>
            </div>
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>æ ‡é¢˜</th>
                        <th>åˆ†ç±»</th>
                        <th>ä½œè€…</th>
                        <th>çŠ¶æ€</th>
                        <th>å‘å¸ƒæ—¶é—´</th>
                        <th>æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>#101</td>
                        <td>Welcome to JJConnect</td>
                        <td>å…¬å‘Š</td>
                        <td>Admin User</td>
                        <td><span class="badge badge-active">å·²å‘å¸ƒ</span></td>
                        <td>2025-02-01</td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn btn-secondary btn-sm" onclick="handleEditContent(101)">ç¼–è¾‘</button>
                                <button class="btn btn-danger btn-sm" onclick="handleDeleteContent(101)">åˆ é™¤</button>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>#102</td>
                        <td>Latest Updates</td>
                        <td>æ–°é—»</td>
                        <td>Editor John</td>
                        <td><span class="badge badge-active">å·²å‘å¸ƒ</span></td>
                        <td>2025-02-03</td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn btn-secondary btn-sm" onclick="handleEditContent(102)">ç¼–è¾‘</button>
                                <button class="btn btn-danger btn-sm" onclick="handleDeleteContent(102)">åˆ é™¤</button>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </section>

    <!-- Settings Section -->
    <section id="settings-section" class="content-section">
        <div class="section-header">
            <h2>ç³»ç»Ÿè®¾ç½®</h2>
            <p>é…ç½®ç³»ç»Ÿå‚æ•°å’Œç½‘ç«™è®¾ç½®</p>
        </div>
        
        <div class="settings-grid">
            <div class="settings-card">
                <h3>ç½‘ç«™åŸºæœ¬è®¾ç½®</h3>
                <p>é…ç½®ç½‘ç«™çš„åŸºæœ¬ä¿¡æ¯å’Œæ˜¾ç¤ºè®¾ç½®</p>
                <form class="form-grid" onsubmit="handleSaveSettings(event, 'general')">
                    <div class="form-group">
                        <label for="site-name">ç½‘ç«™åç§°</label>
                        <input type="text" id="site-name" name="siteName" value="JJConnect" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="site-url">ç½‘ç«™URL</label>
                        <input type="url" id="site-url" name="siteUrl" value="https://jjconnect.jp" required>
                    </div>
                    
                    <div class="form-group" style="grid-column: 1 / -1;">
                        <label for="site-description">ç½‘ç«™æè¿°</label>
                        <textarea id="site-description" name="siteDescription">JJConnect æä¾›é¢å‘ä¸ªäººä¸ä¼ä¸šçš„ä¸“ä¸šè¿æ¥æœåŠ¡</textarea>
                    </div>
                    
                    <div style="grid-column: 1 / -1;">
                        <button type="submit" class="btn btn-primary">ä¿å­˜è®¾ç½®</button>
                    </div>
                </form>
            </div>
            
            <div class="settings-card">
                <h3>é‚®ä»¶è®¾ç½®</h3>
                <p>é…ç½®ç³»ç»Ÿé‚®ä»¶å‘é€è®¾ç½®</p>
                <form class="form-grid" onsubmit="handleSaveSettings(event, 'email')">
                    <div class="form-group">
                        <label for="smtp-host">SMTP ä¸»æœº</label>
                        <input type="text" id="smtp-host" name="smtpHost" placeholder="smtp.example.com" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="smtp-port">SMTP ç«¯å£</label>
                        <input type="number" id="smtp-port" name="smtpPort" placeholder="587" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="smtp-username">ç”¨æˆ·å</label>
                        <input type="text" id="smtp-username" name="smtpUsername" placeholder="username@example.com" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="smtp-password">å¯†ç </label>
                        <input type="password" id="smtp-password" name="smtpPassword" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required>
                    </div>
                    
                    <div style="grid-column: 1 / -1;">
                        <button type="submit" class="btn btn-primary">ä¿å­˜è®¾ç½®</button>
                        <button type="button" class="btn btn-secondary" style="margin-left: 1rem;" onclick="handleTestEmail()">æµ‹è¯•é‚®ä»¶</button>
                    </div>
                </form>
            </div>
            
            <div class="settings-card">
                <h3>å®‰å…¨è®¾ç½®</h3>
                <p>é…ç½®ç³»ç»Ÿå®‰å…¨å’Œè®¿é—®æ§åˆ¶</p>
                <form class="form-grid" onsubmit="handleSaveSettings(event, 'security')">
                    <div class="form-group">
                        <label for="session-timeout">ä¼šè¯è¶…æ—¶ (åˆ†é’Ÿ)</label>
                        <input type="number" id="session-timeout" name="sessionTimeout" value="30" min="5" max="1440" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="max-login-attempts">æœ€å¤§ç™»å½•å°è¯•æ¬¡æ•°</label>
                        <input type="number" id="max-login-attempts" name="maxLoginAttempts" value="5" min="3" max="10" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="password-min-length">å¯†ç æœ€å°é•¿åº¦</label>
                        <input type="number" id="password-min-length" name="passwordMinLength" value="8" min="6" max="20" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="two-factor-auth">åŒå› ç´ è®¤è¯</label>
                        <select id="two-factor-auth" name="twoFactorAuth" required>
                            <option value="disabled">ç¦ç”¨</option>
                            <option value="optional">å¯é€‰</option>
                            <option value="required">å¿…éœ€</option>
                        </select>
                    </div>
                    
                    <div style="grid-column: 1 / -1;">
                        <button type="submit" class="btn btn-primary">ä¿å­˜è®¾ç½®</button>
                    </div>
                </form>
            </div>
        </div>
    </section>
    
    <!-- Submissions Section (NEW) -->
    <section id="submissions-section" class="content-section">
        <div class="section-header">
            <h2>æäº¤ç®¡ç†</h2>
            <p>æŸ¥çœ‹å’Œå¤„ç† Joint Mamori Project æäº¤è®°å½•</p>
        </div>
        
        <div class="stats-grid">
            <div class="stat-card">
                <h3>æ€»æäº¤æ•°</h3>
                <div class="stat-value" id="total-submissions">0</div>
            </div>
            <div class="stat-card">
                <h3>å¾…å¤„ç†</h3>
                <div class="stat-value" id="pending-submissions">0</div>
            </div>
            <div class="stat-card">
                <h3>å·²å®¡æ ¸</h3>
                <div class="stat-value" id="reviewed-submissions">0</div>
            </div>
            <div class="stat-card">
                <h3>å·²è§£å†³</h3>
                <div class="stat-value" id="resolved-submissions">0</div>
            </div>
        </div>
        
        <div class="table-container">
            <div class="table-header">
                <h3>æäº¤è®°å½•</h3>
                <div style="display: flex; gap: 1rem;">
                    <select id="filter-status" class="btn btn-secondary" style="padding: 0.625rem 1rem;">
                        <option value="">å…¨éƒ¨çŠ¶æ€</option>
                        <option value="pending">å¾…å¤„ç†</option>
                        <option value="reviewed">å·²å®¡æ ¸</option>
                        <option value="resolved">å·²è§£å†³</option>
                        <option value="archived">å·²å½’æ¡£</option>
                    </select>
                    <button class="btn btn-primary" onclick="loadSubmissions()">åˆ·æ–°åˆ—è¡¨</button>
                </div>
            </div>
            <div id="submissions-loading" style="padding: 2rem; text-align: center; display: none;">
                <p>åŠ è½½ä¸­...</p>
            </div>
            <div id="submissions-table-container">
                <table id="submissions-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>æäº¤è€…</th>
                            <th>é‚®ç®±</th>
                            <th>å…³ç³»ç±»å‹</th>
                            <th>å†…å®¹æ‘˜è¦</th>
                            <th>åª’ä½“</th>
                            <th>çŠ¶æ€</th>
                            <th>æäº¤æ—¶é—´</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody id="submissions-tbody">
                        <tr>
                            <td colspan="9" style="text-align: center; padding: 2rem; color: var(--global-palette5);">
                                ç‚¹å‡»"åˆ·æ–°åˆ—è¡¨"åŠ è½½æäº¤è®°å½•
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </section>
</main>

<script>
// ============================================
// Permission Control System
// ============================================

/**
 * User Role Definitions
 * 0: Viewer (è®¿å®¢) - Can only view content, no edit/delete permissions
 * 1: Editor (ç¼–è¾‘) - Can create and edit content, cannot delete users or change settings
 * 2: Admin (ç®¡ç†å‘˜) - Full access to all features
 */

// Current user role - This should be set from backend authentication
// For testing, you can change this value: 0 (Viewer), 1 (Editor), or 2 (Admin)
// Check localStorage for test role (from admin-test.html)
let userRole = parseInt(localStorage.getItem('testUserRole')) || 2; // Default: Admin for testing

// Role constants for better code readability
const ROLE = {
    VIEWER: 0,
    EDITOR: 1,
    ADMIN: 2
};

// Role names mapping
const ROLE_NAMES = {
    0: 'Viewer',
    1: 'Editor',
    2: 'Admin'
};

/**
 * Check authentication and get user role from Cloudflare Workers
 * API Endpoint: GET /api/auth/check
 * Response: { authenticated: boolean, role: number, username: string, email: string }
 * 
 * This function should be called on page load to verify user authentication
 * and retrieve their role from Cloudflare Workers backend.
 */
async function checkAuth() {
    try {
        // TODO: Replace with your actual Cloudflare Workers API endpoint
        const CLOUDFLARE_AUTH_ENDPOINT = 'https://your-worker.your-subdomain.workers.dev/api/auth/check';
        
        // Example implementation for Cloudflare Workers integration:
        /*
        const response = await fetch(CLOUDFLARE_AUTH_ENDPOINT, {
            method: 'GET',
            credentials: 'include', // Include cookies for session management
            headers: {
                'Content-Type': 'application/json',
                // Add authorization header if using JWT tokens
                // 'Authorization': `Bearer ${localStorage.getItem('authToken')}`
            }
        });
        
        if (!response.ok) {
            throw new Error('Authentication failed');
        }
        
        const data = await response.json();
        
        if (!data.authenticated) {
            // User is not authenticated, redirect to login
            window.location.href = 'login.html';
            return null;
        }
        
        // Set user role from backend response
        userRole = data.role;
        
        // Update UI with user information
        if (data.username) {
            document.querySelector('.user-name').textContent = data.username;
            const initials = data.username.substring(0, 2).toUpperCase();
            document.querySelector('.user-avatar').textContent = initials;
        }
        
        // Apply permission controls based on role
        applyPermissionControls();
        
        console.log('Authentication successful:', {
            username: data.username,
            role: ROLE_NAMES[data.role],
            email: data.email
        });
        
        return data;
        */
        
        // For development/testing without backend:
        console.log('âš ï¸ checkAuth() - Using mock authentication');
        console.log('Current user role:', ROLE_NAMES[userRole]);
        console.log('To integrate with Cloudflare Workers, uncomment the fetch code above');
        
        // Apply permission controls with current role
        applyPermissionControls();
        
        return {
            authenticated: true,
            role: userRole,
            username: 'Test User',
            email: 'test@jjconnect.jp'
        };
        
    } catch (error) {
        console.error('Authentication error:', error);
        
        // On error, redirect to login page
        // Uncomment in production:
        // window.location.href = 'login.html';
        
        return null;
    }
}

/**
 * Apply permission controls based on user role
 * This function shows/hides UI elements based on user permissions
 */
function applyPermissionControls() {
    console.log('Applying permission controls for role:', ROLE_NAMES[userRole]);
    
    // Define permission rules
    const permissions = {
        // User Management Permissions
        canAddUser: userRole >= ROLE.ADMIN,
        canEditUser: userRole >= ROLE.EDITOR,
        canDeleteUser: userRole >= ROLE.ADMIN,
        
        // Content Management Permissions
        canPublishContent: userRole >= ROLE.EDITOR,
        canEditContent: userRole >= ROLE.EDITOR,
        canDeleteContent: userRole >= ROLE.ADMIN,
        canSaveDraft: userRole >= ROLE.EDITOR,
        
        // Settings Permissions
        canAccessSettings: userRole >= ROLE.ADMIN,
        canModifySettings: userRole >= ROLE.ADMIN,
        
        // Navigation Permissions
        canAccessUserManagement: userRole >= ROLE.EDITOR,
        canAccessContentManagement: userRole >= ROLE.EDITOR,
        canAccessSystemSettings: userRole >= ROLE.ADMIN
    };
    
    // Apply User Management permissions
    applyUserManagementPermissions(permissions);
    
    // Apply Content Management permissions
    applyContentManagementPermissions(permissions);
    
    // Apply Settings permissions
    applySettingsPermissions(permissions);
    
    // Apply Navigation permissions
    applyNavigationPermissions(permissions);
    
    // Add visual indicator for current role
    addRoleIndicator();
    
    console.log('âœ“ Permission controls applied successfully');
}

/**
 * Apply permissions for User Management section
 */
function applyUserManagementPermissions(permissions) {
    // Hide/Show "Add User" button
    const addUserBtn = document.querySelector('#users-section .btn-primary');
    if (addUserBtn) {
        addUserBtn.style.display = permissions.canAddUser ? 'inline-block' : 'none';
    }
    
    // Hide/Show delete buttons in user table
    const deleteUserBtns = document.querySelectorAll('#users-section .btn-danger');
    deleteUserBtns.forEach(btn => {
        btn.style.display = permissions.canDeleteUser ? 'inline-block' : 'none';
        if (!permissions.canDeleteUser) {
            btn.disabled = true;
            btn.title = 'æ‚¨æ²¡æœ‰åˆ é™¤ç”¨æˆ·çš„æƒé™';
        }
    });
    
    // Hide/Show edit buttons in user table
    const editUserBtns = document.querySelectorAll('#users-section .btn-secondary');
    editUserBtns.forEach(btn => {
        btn.style.display = permissions.canEditUser ? 'inline-block' : 'none';
        if (!permissions.canEditUser) {
            btn.disabled = true;
            btn.title = 'æ‚¨æ²¡æœ‰ç¼–è¾‘ç”¨æˆ·çš„æƒé™';
        }
    });
    
    // If user is Viewer, show a message
    if (userRole === ROLE.VIEWER) {
        const tableContainer = document.querySelector('#users-section .table-container');
        if (tableContainer && !document.querySelector('.permission-notice')) {
            const notice = document.createElement('div');
            notice.className = 'permission-notice';
            notice.style.cssText = 'padding: 1rem; background: #FFF3CD; border: 1px solid #FFC107; border-radius: 8px; margin-bottom: 1rem; color: #856404;';
            notice.innerHTML = '<strong>âš ï¸ åªè¯»æ¨¡å¼</strong> - æ‚¨å½“å‰æ˜¯è®¿å®¢æƒé™ï¼Œåªèƒ½æŸ¥çœ‹ç”¨æˆ·åˆ—è¡¨ï¼Œæ— æ³•è¿›è¡Œç¼–è¾‘æˆ–åˆ é™¤æ“ä½œã€‚';
            tableContainer.parentNode.insertBefore(notice, tableContainer);
        }
    }
}

/**
 * Apply permissions for Content Management section
 */
function applyContentManagementPermissions(permissions) {
    // Hide/Show publish content form
    const contentForm = document.querySelector('#content-section form');
    if (contentForm) {
        if (!permissions.canPublishContent) {
            contentForm.style.display = 'none';
            const notice = document.createElement('div');
            notice.className = 'permission-notice';
            notice.style.cssText = 'padding: 1.5rem; background: #FFF3CD; border: 1px solid #FFC107; border-radius: 8px; margin: 1rem; color: #856404; text-align: center;';
            notice.innerHTML = '<strong>âš ï¸ æƒé™ä¸è¶³</strong><br>æ‚¨æ²¡æœ‰å‘å¸ƒå†…å®¹çš„æƒé™ã€‚è¯·è”ç³»ç®¡ç†å‘˜å‡çº§æ‚¨çš„è´¦æˆ·æƒé™ã€‚';
            contentForm.parentNode.insertBefore(notice, contentForm);
        }
    }
    
    // Hide/Show "Save Draft" button
    const saveDraftBtn = document.querySelector('#content-section .btn-secondary');
    if (saveDraftBtn) {
        saveDraftBtn.style.display = permissions.canSaveDraft ? 'inline-block' : 'none';
    }
    
    // Hide/Show delete buttons in content table
    const deleteContentBtns = document.querySelectorAll('#content-section .btn-danger');
    deleteContentBtns.forEach(btn => {
        btn.style.display = permissions.canDeleteContent ? 'inline-block' : 'none';
        if (!permissions.canDeleteContent) {
            btn.disabled = true;
            btn.title = 'åªæœ‰ç®¡ç†å‘˜å¯ä»¥åˆ é™¤å†…å®¹';
        }
    });
    
    // Hide/Show edit buttons in content table
    const editContentBtns = document.querySelectorAll('#content-section .btn-secondary.btn-sm');
    editContentBtns.forEach(btn => {
        if (!permissions.canEditContent) {
            btn.disabled = true;
            btn.title = 'æ‚¨æ²¡æœ‰ç¼–è¾‘å†…å®¹çš„æƒé™';
        }
    });
}

/**
 * Apply permissions for Settings section
 */
function applySettingsPermissions(permissions) {
    const settingsSection = document.querySelector('#settings-section');
    
    if (!permissions.canAccessSettings) {
        // Hide all settings forms
        if (settingsSection) {
            settingsSection.innerHTML = `
                <div class="section-header">
                    <h2>ç³»ç»Ÿè®¾ç½®</h2>
                    <p>é…ç½®ç³»ç»Ÿå‚æ•°å’Œç½‘ç«™è®¾ç½®</p>
                </div>
                <div style="padding: 3rem; text-align: center; background: var(--global-palette9); border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                    <div style="font-size: 48px; margin-bottom: 1rem;">ğŸ”’</div>
                    <h3 style="color: var(--global-palette3); margin-bottom: 0.5rem;">è®¿é—®å—é™</h3>
                    <p style="color: var(--global-palette5);">åªæœ‰ç®¡ç†å‘˜å¯ä»¥è®¿é—®ç³»ç»Ÿè®¾ç½®ã€‚</p>
                </div>
            `;
        }
    } else {
        // Disable form inputs if user cannot modify settings
        if (!permissions.canModifySettings) {
            const settingsForms = settingsSection.querySelectorAll('form');
            settingsForms.forEach(form => {
                const inputs = form.querySelectorAll('input, select, textarea, button[type="submit"]');
                inputs.forEach(input => {
                    input.disabled = true;
                });
            });
        }
    }
}

/**
 * Apply permissions for Navigation (Sidebar)
 */
function applyNavigationPermissions(permissions) {
    // Hide/Show sidebar menu items based on permissions
    const menuItems = document.querySelectorAll('.sidebar-menu-link');
    
    menuItems.forEach(link => {
        const section = link.getAttribute('data-section');
        let hasAccess = true;
        
        switch(section) {
            case 'users':
                hasAccess = permissions.canAccessUserManagement;
                break;
            case 'content':
                hasAccess = permissions.canAccessContentManagement;
                break;
            case 'settings':
                hasAccess = permissions.canAccessSystemSettings;
                break;
        }
        
        if (!hasAccess) {
            link.style.opacity = '0.5';
            link.style.pointerEvents = 'none';
            link.title = 'æ‚¨æ²¡æœ‰è®¿é—®æ­¤æ¨¡å—çš„æƒé™';
            
            // Add lock icon
            if (!link.querySelector('.lock-icon')) {
                const lockIcon = document.createElement('span');
                lockIcon.className = 'lock-icon';
                lockIcon.textContent = 'ğŸ”’';
                lockIcon.style.marginLeft = 'auto';
                link.appendChild(lockIcon);
            }
        }
    });
    
    // If current active section is not accessible, switch to first accessible section
    const activeLink = document.querySelector('.sidebar-menu-link.active');
    if (activeLink && activeLink.style.pointerEvents === 'none') {
        const firstAccessibleLink = document.querySelector('.sidebar-menu-link:not([style*="pointer-events: none"])');
        if (firstAccessibleLink) {
            firstAccessibleLink.click();
        }
    }
}

/**
 * Add visual indicator for current user role
 */
function addRoleIndicator() {
    const userInfo = document.querySelector('.user-info');
    if (userInfo && !document.querySelector('.role-badge')) {
        const roleBadge = document.createElement('span');
        roleBadge.className = 'role-badge';
        roleBadge.textContent = ROLE_NAMES[userRole];
        
        // Style based on role
        let badgeColor;
        switch(userRole) {
            case ROLE.ADMIN:
                badgeColor = '#9F7AEA';
                break;
            case ROLE.EDITOR:
                badgeColor = '#4299E1';
                break;
            case ROLE.VIEWER:
                badgeColor = '#718096';
                break;
        }
        
        roleBadge.style.cssText = `
            display: inline-block;
            padding: 0.25rem 0.75rem;
            background: ${badgeColor};
            color: white;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            margin-left: 0.5rem;
        `;
        
        userInfo.appendChild(roleBadge);
    }
}

/**
 * Check if user has specific permission
 * @param {string} action - The action to check (e.g., 'deleteUser', 'publishContent')
 * @returns {boolean} - Whether user has permission
 */
function hasPermission(action) {
    const permissionMap = {
        // User actions
        'addUser': userRole >= ROLE.ADMIN,
        'editUser': userRole >= ROLE.EDITOR,
        'deleteUser': userRole >= ROLE.ADMIN,
        
        // Content actions
        'publishContent': userRole >= ROLE.EDITOR,
        'editContent': userRole >= ROLE.EDITOR,
        'deleteContent': userRole >= ROLE.ADMIN,
        'saveDraft': userRole >= ROLE.EDITOR,
        
        // Settings actions
        'viewSettings': userRole >= ROLE.ADMIN,
        'modifySettings': userRole >= ROLE.ADMIN
    };
    
    return permissionMap[action] || false;
}

/**
 * Show permission denied message
 * @param {string} action - The action that was denied
 */
function showPermissionDenied(action) {
    alert(`âš ï¸ æƒé™ä¸è¶³\n\næ‚¨æ²¡æœ‰æ‰§è¡Œ"${action}"æ“ä½œçš„æƒé™ã€‚\nå½“å‰è§’è‰²: ${ROLE_NAMES[userRole]}\n\nè¯·è”ç³»ç®¡ç†å‘˜ä»¥è·å–æ›´é«˜æƒé™ã€‚`);
}

/**
 * Switch user role (for development/testing only)
 * @param {number|string} newRole - The new role to switch to
 */
function switchRole(newRole) {
    newRole = parseInt(newRole);
    
    if (newRole < 0 || newRole > 2) {
        console.error('Invalid role:', newRole);
        return;
    }
    
    const oldRole = userRole;
    userRole = newRole;
    
    console.log(`ğŸ”„ Role switched: ${ROLE_NAMES[oldRole]} â†’ ${ROLE_NAMES[newRole]}`);
    
    // Remove existing role badge
    const existingBadge = document.querySelector('.role-badge');
    if (existingBadge) {
        existingBadge.remove();
    }
    
    // Remove existing permission notices
    const notices = document.querySelectorAll('.permission-notice');
    notices.forEach(notice => notice.remove());
    
    // Reapply permission controls
    applyPermissionControls();
    
    // Update debug panel display
    const roleDisplay = document.getElementById('current-role-display');
    if (roleDisplay) {
        roleDisplay.textContent = ROLE_NAMES[newRole];
    }
    
    // Show notification
    const notification = document.createElement('div');
    notification.style.cssText = `
        position: fixed;
        top: 80px;
        right: 20px;
        background: var(--global-palette1);
        color: var(--global-palette9);
        padding: 1rem 1.5rem;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        z-index: 10000;
        animation: slideIn 0.3s ease;
    `;
    notification.innerHTML = `
        <strong>âœ“ è§’è‰²å·²åˆ‡æ¢</strong><br>
        <span style="font-size: 13px;">å½“å‰è§’è‰²: ${ROLE_NAMES[newRole]}</span>
    `;
    
    document.body.appendChild(notification);
    
    // Remove notification after 3 seconds
    setTimeout(() => {
        notification.style.animation = 'slideOut 0.3s ease';
        setTimeout(() => notification.remove(), 300);
    }, 3000);
}

// ============================================
// Navigation & UI Functions
// ============================================

// Sidebar navigation
document.querySelectorAll('.sidebar-menu-link').forEach(link => {
    link.addEventListener('click', function(e) {
        e.preventDefault();
        
        // Update active link
        document.querySelectorAll('.sidebar-menu-link').forEach(l => l.classList.remove('active'));
        this.classList.add('active');
        
        // Show corresponding section
        const sectionId = this.getAttribute('data-section');
        document.querySelectorAll('.content-section').forEach(section => {
            section.classList.remove('active');
        });
        document.getElementById(sectionId + '-section').classList.add('active');
    });
});

// ============================================
// User Management Functions
// ============================================

/**
 * Add new user
 * API Endpoint: POST /api/users
 * Request Body: { username, email, role, status }
 */
function handleAddUser() {
    // Permission check
    if (!hasPermission('addUser')) {
        showPermissionDenied('æ·»åŠ ç”¨æˆ·');
        return;
    }
    
    // TODO: Implement add user modal/form
    // API call example:
    /*
    fetch('/api/users', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
            username: 'new_user',
            email: 'user@example.com',
            role: 'viewer',
            status: 'active'
        })
    })
    .then(response => response.json())
    .then(data => {
        console.log('User added:', data);
        // Refresh user list
    })
    .catch(error => console.error('Error:', error));
    */
    alert('æ·»åŠ ç”¨æˆ·åŠŸèƒ½\n\nAPI Endpoint: POST /api/users\nRequest Body: { username, email, role, status }');
}

/**
 * Edit user
 * API Endpoint: PUT /api/users/:id
 * Request Body: { username, email, role, status }
 */
function handleEditUser(userId) {
    // Permission check
    if (!hasPermission('editUser')) {
        showPermissionDenied('ç¼–è¾‘ç”¨æˆ·');
        return;
    }
    
    // TODO: Implement edit user modal/form
    // API call example:
    /*
    fetch(`/api/users/${userId}`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
            username: 'updated_user',
            email: 'updated@example.com',
            role: 'editor',
            status: 'active'
        })
    })
    .then(response => response.json())
    .then(data => {
        console.log('User updated:', data);
        // Refresh user list
    })
    .catch(error => console.error('Error:', error));
    */
    alert(`ç¼–è¾‘ç”¨æˆ· #${userId}\n\nAPI Endpoint: PUT /api/users/${userId}\nRequest Body: { username, email, role, status }`);
}

/**
 * Delete user
 * API Endpoint: DELETE /api/users/:id
 */
function handleDeleteUser(userId) {
    // Permission check
    if (!hasPermission('deleteUser')) {
        showPermissionDenied('åˆ é™¤ç”¨æˆ·');
        return;
    }
    
    if (!confirm(`ç¡®å®šè¦åˆ é™¤ç”¨æˆ· #${userId} å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚`)) {
        return;
    }
    
    // TODO: Implement delete user
    // API call example:
    /*
    fetch(`/api/users/${userId}`, {
        method: 'DELETE',
        headers: { 'Content-Type': 'application/json' }
    })
    .then(response => response.json())
    .then(data => {
        console.log('User deleted:', data);
        // Refresh user list
    })
    .catch(error => console.error('Error:', error));
    */
    alert(`åˆ é™¤ç”¨æˆ· #${userId}\n\nAPI Endpoint: DELETE /api/users/${userId}`);
}

// ============================================
// Content Management Functions
// ============================================

/**
 * Publish content
 * API Endpoint: POST /api/content
 * Request Body: { title, category, body, author, status }
 */
function handlePublishContent(event) {
    event.preventDefault();
    
    // Permission check
    if (!hasPermission('publishContent')) {
        showPermissionDenied('å‘å¸ƒå†…å®¹');
        return;
    }
    
    const formData = new FormData(event.target);
    const data = Object.fromEntries(formData);
    
    // TODO: Implement publish content
    // API call example:
    /*
    fetch('/api/content', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
    })
    .then(response => response.json())
    .then(result => {
        console.log('Content published:', result);
        alert('å†…å®¹å‘å¸ƒæˆåŠŸï¼');
        event.target.reset();
        // Refresh content list
    })
    .catch(error => console.error('Error:', error));
    */
    console.log('Publishing content:', data);
    alert('å†…å®¹å‘å¸ƒæˆåŠŸï¼\n\nAPI Endpoint: POST /api/content\nRequest Body: ' + JSON.stringify(data, null, 2));
}

/**
 * Save draft
 * API Endpoint: POST /api/content/draft
 * Request Body: { title, category, body, author }
 */
function handleSaveDraft() {
    // TODO: Implement save draft
    // API call example:
    /*
    const formData = {
        title: document.getElementById('content-title').value,
        category: document.getElementById('content-category').value,
        body: document.getElementById('content-body').value,
        author: document.getElementById('content-author').value
    };
    
    fetch('/api/content/draft', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(formData)
    })
    .then(response => response.json())
    .then(data => {
        console.log('Draft saved:', data);
        alert('è‰ç¨¿ä¿å­˜æˆåŠŸï¼');
    })
    .catch(error => console.error('Error:', error));
    */
    alert('ä¿å­˜è‰ç¨¿\n\nAPI Endpoint: POST /api/content/draft');
}

/**
 * Edit content
 * API Endpoint: PUT /api/content/:id
 * Request Body: { title, category, body, author, status }
 */
function handleEditContent(contentId) {
    // TODO: Implement edit content
    // API call example:
    /*
    fetch(`/api/content/${contentId}`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
            title: 'Updated Title',
            category: 'news',
            body: 'Updated content...',
            author: 'Editor',
            status: 'published'
        })
    })
    .then(response => response.json())
    .then(data => {
        console.log('Content updated:', data);
        // Refresh content list
    })
    .catch(error => console.error('Error:', error));
    */
    alert(`ç¼–è¾‘å†…å®¹ #${contentId}\n\nAPI Endpoint: PUT /api/content/${contentId}`);
}

/**
 * Delete content
 * API Endpoint: DELETE /api/content/:id
 */
function handleDeleteContent(contentId) {
    // Permission check
    if (!hasPermission('deleteContent')) {
        showPermissionDenied('åˆ é™¤å†…å®¹');
        return;
    }
    
    if (!confirm(`ç¡®å®šè¦åˆ é™¤å†…å®¹ #${contentId} å—ï¼Ÿ`)) {
        return;
    }
    
    // TODO: Implement delete content
    // API call example:
    /*
    fetch(`/api/content/${contentId}`, {
        method: 'DELETE',
        headers: { 'Content-Type': 'application/json' }
    })
    .then(response => response.json())
    .then(data => {
        console.log('Content deleted:', data);
        // Refresh content list
    })
    .catch(error => console.error('Error:', error));
    */
    alert(`åˆ é™¤å†…å®¹ #${contentId}\n\nAPI Endpoint: DELETE /api/content/${contentId}`);
}

// ============================================
// Settings Functions
// ============================================

/**
 * Save settings
 * API Endpoint: PUT /api/settings/:type
 * Request Body: { ...settings }
 */
function handleSaveSettings(event, settingsType) {
    event.preventDefault();
    
    const formData = new FormData(event.target);
    const data = Object.fromEntries(formData);
    
    // TODO: Implement save settings
    // API call example:
    /*
    fetch(`/api/settings/${settingsType}`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
    })
    .then(response => response.json())
    .then(result => {
        console.log('Settings saved:', result);
        alert('è®¾ç½®ä¿å­˜æˆåŠŸï¼');
    })
    .catch(error => console.error('Error:', error));
    */
    console.log(`Saving ${settingsType} settings:`, data);
    alert(`${settingsType} è®¾ç½®ä¿å­˜æˆåŠŸï¼\n\nAPI Endpoint: PUT /api/settings/${settingsType}\nRequest Body: ` + JSON.stringify(data, null, 2));
}

/**
 * Test email configuration
 * API Endpoint: POST /api/settings/test-email
 */
function handleTestEmail() {
    // TODO: Implement test email
    // API call example:
    /*
    fetch('/api/settings/test-email', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' }
    })
    .then(response => response.json())
    .then(data => {
        console.log('Test email result:', data);
        alert(data.success ? 'æµ‹è¯•é‚®ä»¶å‘é€æˆåŠŸï¼' : 'æµ‹è¯•é‚®ä»¶å‘é€å¤±è´¥ï¼š' + data.error);
    })
    .catch(error => console.error('Error:', error));
    */
    alert('æµ‹è¯•é‚®ä»¶å‘é€\n\nAPI Endpoint: POST /api/settings/test-email');
}

// ============================================
// Submissions Management Functions (NEW)
// ============================================

/**
 * Load submissions from API
 * API Endpoint: GET /api/submissions?status=pending&limit=100
 */
async function loadSubmissions() {
    // Permission check
    if (!hasPermission('viewSettings')) {
        showPermissionDenied('æŸ¥çœ‹æäº¤è®°å½•');
        return;
    }
    
    const loadingDiv = document.getElementById('submissions-loading');
    const tbody = document.getElementById('submissions-tbody');
    const filterStatus = document.getElementById('filter-status').value;
    
    try {
        // Show loading
        loadingDiv.style.display = 'block';
        tbody.innerHTML = '';
        
        // Build API URL
        let apiUrl = '/api/submissions?limit=100';
        if (filterStatus) {
            apiUrl += `&status=${filterStatus}`;
        }
        
        // TODO: Replace with actual API call
        const response = await fetch(apiUrl, {
            headers: {
                'Authorization': `Bearer ${localStorage.getItem('auth_token')}`
            }
        });
        
        if (!response.ok) {
            throw new Error(`API Error: ${response.status}`);
        }
        
        const result = await response.json();
        
        // Update statistics
        updateSubmissionStats(result.submissions || []);
        
        // Render table
        if (result.submissions && result.submissions.length > 0) {
            tbody.innerHTML = result.submissions.map(sub => {
                const statusBadge = getStatusBadge(sub.status);
                const contentPreview = sub.content ? 
                    (sub.content.length > 50 ? sub.content.substring(0, 50) + '...' : sub.content) : 
                    'ç„¡';
                
                // Check if media is an image
                const isImage = sub.media_key && sub.media_type && sub.media_type.startsWith('image/');
                const mediaDisplay = sub.media_key ? 
                    (isImage ? 
                        `<img src="/api/files/${sub.media_key}" alt="${sub.media_filename}" 
                              style="max-width: 100px; max-height: 60px; object-fit: cover; border-radius: 4px; cursor: pointer;"
                              onclick="viewMediaFullscreen('${sub.media_key}', '${sub.media_filename}', '${sub.media_type}')">` :
                        `<a href="/api/files/${sub.media_key}" target="_blank">ğŸ“ ${sub.media_filename}</a>`) :
                    '-';
                
                return `
                    <tr>
                        <td>#${sub.id}</td>
                        <td>${sub.user_name || 'åŒ¿å'}</td>
                        <td>${sub.user_email || '-'}</td>
                        <td>${sub.relation_type || '-'}</td>
                        <td title="${sub.content || ''}">${contentPreview}</td>
                        <td>${mediaDisplay}</td>
                        <td>${statusBadge}</td>
                        <td>${formatDate(sub.created_at)}</td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn btn-secondary btn-sm" onclick="viewSubmission(${sub.id})">è©³ç´°</button>
                                ${sub.status === 'pending' ? 
                                    `<button class="btn btn-primary btn-sm" onclick="markAsReviewed(${sub.id})">æ¨™è¨˜ç‚ºå·²è™•ç†</button>` :
                                    `<button class="btn btn-secondary btn-sm" onclick="updateSubmissionStatus(${sub.id})">çŠ¶æ…‹è®Šæ›´</button>`
                                }
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
        } else {
            tbody.innerHTML = `
                <tr>
                    <td colspan="9" style="text-align: center; padding: 2rem; color: var(--global-palette5);">
                        ${filterStatus ? `"${filterStatus}" ç‹€æ…‹çš„æäº¤è¨˜éŒ„ä¸å­˜åœ¨` : 'æäº¤è¨˜éŒ„ä¸å­˜åœ¨'}
                    </td>
                </tr>
            `;
        }
        
    } catch (error) {
        console.error('Load submissions error:', error);
        tbody.innerHTML = `
            <tr>
                <td colspan="9" style="text-align: center; padding: 2rem; color: var(--error-color);">
                    éŒ¯èª¤: ${error.message}
                </td>
            </tr>
        `;
    } finally {
        loadingDiv.style.display = 'none';
    }
}

/**
 * View media in fullscreen modal
 */
function viewMediaFullscreen(mediaKey, filename, mimeType) {
    const isImage = mimeType && mimeType.startsWith('image/');
    const isVideo = mimeType && mimeType.startsWith('video/');
    const fileUrl = `/api/files/${mediaKey}`;
    
    // Create modal
    const modal = document.createElement('div');
    modal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0,0,0,0.9);
        z-index: 10000;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        padding: 20px;
    `;
    
    modal.innerHTML = `
        <div style="max-width: 90vw; max-height: 90vh; display: flex; flex-direction: column; align-items: center;">
            <div style="color: white; margin-bottom: 15px; font-size: 18px; font-weight: 600;">
                ${filename}
            </div>
            ${isImage ? 
                `<img src="${fileUrl}" alt="${filename}" style="max-width: 100%; max-height: 80vh; object-fit: contain;">` :
                isVideo ?
                `<video src="${fileUrl}" controls style="max-width: 100%; max-height: 80vh;">Your browser does not support video.</video>` :
                `<div style="color: white; text-align: center;">
                    <p>ç„¡æ³•é è¦½æ­¤æ–‡ä»¶é¡å‹</p>
                    <a href="${fileUrl}" target="_blank" style="color: #4299E1;">ä¸‹è¼‰æ–‡ä»¶</a>
                </div>`
            }
            <div style="margin-top: 20px; display: flex; gap: 15px;">
                <button onclick="window.open('${fileUrl}')" 
                        style="padding: 10px 20px; background: #2B6CB0; color: white; border: none; border-radius: 6px; cursor: pointer;">
                    åœ¨æ–°æ¨™ç±¤é ä¸­æ‰“é–‹
                </button>
                <button onclick="this.closest('div[style*=fixed]').remove()" 
                        style="padding: 10px 20px; background: #718096; color: white; border: none; border-radius: 6px; cursor: pointer;">
                    é—œé–‰
                </button>
            </div>
        </div>
    `;
    
    // Close on background click
    modal.addEventListener('click', (e) => {
        if (e.target === modal) {
            modal.remove();
        }
    });
    
    // Close on Escape key
    const handleEscape = (e) => {
        if (e.key === 'Escape') {
            modal.remove();
            document.removeEventListener('keydown', handleEscape);
        }
    };
    document.addEventListener('keydown', handleEscape);
    
    document.body.appendChild(modal);
}

/**
 * Mark submission as reviewed
 */
async function markAsReviewed(submissionId) {
    if (!hasPermission('modifySettings')) {
        showPermissionDenied('æ¨™è¨˜ç‚ºå·²è™•ç†');
        return;
    }
    
    if (!confirm('ç¢ºèªæ¨™è¨˜æ­¤æäº¤ç‚ºå·²è™•ç†?')) {
        return;
    }
    
    try {
        const response = await fetch(`/api/submissions/${submissionId}`, {
            method: 'PATCH',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${localStorage.getItem('auth_token')}`
            },
            body: JSON.stringify({
                status: 'reviewed'
            })
        });
        
        const result = await response.json();
        
        if (response.ok && result.success) {
            alert('âœ“ å·²æ¨™è¨˜ç‚ºå·²è™•ç†');
            loadSubmissions(); // Reload list
        } else {
            throw new Error(result.error || 'æ›´æ–°å¤±æ•—');
        }
    } catch (error) {
        console.error('Mark as reviewed error:', error);
        alert('âœ— éŒ¯èª¤: ' + error.message);
    }
}

/**
 * Update submission statistics
 */
function updateSubmissionStats(submissions) {
    const total = submissions.length;
    const pending = submissions.filter(s => s.status === 'pending').length;
    const reviewed = submissions.filter(s => s.status === 'reviewed').length;
    const resolved = submissions.filter(s => s.status === 'resolved').length;
    
    document.getElementById('total-submissions').textContent = total;
    document.getElementById('pending-submissions').textContent = pending;
    document.getElementById('reviewed-submissions').textContent = reviewed;
    document.getElementById('resolved-submissions').textContent = resolved;
}

/**
 * Get status badge HTML
 */
function getStatusBadge(status) {
    const badges = {
        'pending': '<span class="badge" style="background: #FFA500;">å¾…å‡¦ç†</span>',
        'reviewed': '<span class="badge" style="background: #4299E1;">å¯©æ ¸æ¸ˆ</span>',
        'resolved': '<span class="badge badge-active">è§£æ±ºæ¸ˆ</span>',
        'archived': '<span class="badge" style="background: #718096;">ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–</span>'
    };
    return badges[status] || '<span class="badge badge-viewer">ä¸æ˜</span>';
}

/**
 * Format date string
 */
function formatDate(dateStr) {
    if (!dateStr) return '-';
    const date = new Date(dateStr);
    return date.toLocaleString('ja-JP', {
        year: 'numeric',
        month: '2-digit',
        day: '2-digit',
        hour: '2-digit',
        minute: '2-digit'
    });
}

/**
 * View submission details (Enhanced)
 */
async function viewSubmission(submissionId) {
    try {
        const response = await fetch(`/api/submissions?limit=1000`, {
            headers: {
                'Authorization': `Bearer ${localStorage.getItem('auth_token')}`
            }
        });
        
        if (!response.ok) {
            throw new Error('Failed to fetch submission');
        }
        
        const result = await response.json();
        const submission = result.submissions.find(s => s.id === submissionId);
        
        if (!submission) {
            throw new Error('Submission not found');
        }
        
        // Create detail modal
        const modal = document.createElement('div');
        modal.style.cssText = `
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        `;
        
        const isImage = submission.media_key && submission.media_type && submission.media_type.startsWith('image/');
        const isVideo = submission.media_key && submission.media_type && submission.media_type.startsWith('video/');
        
        modal.innerHTML = `
            <div style="background: white; border-radius: 16px; max-width: 800px; max-height: 90vh; overflow-y: auto; width: 100%;">
                <div style="padding: 2rem; border-bottom: 1px solid var(--global-palette7);">
                    <h2 style="margin: 0; color: var(--global-palette3);">æäº¤è©³ç´° #${submission.id}</h2>
                </div>
                
                <div style="padding: 2rem;">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
                        <div>
                            <div style="font-weight: 600; color: var(--global-palette5); font-size: 13px; margin-bottom: 0.5rem;">æäº¤è€…å§“å</div>
                            <div style="color: var(--global-palette3); font-size: 15px;">${submission.user_name || 'åŒ¿å'}</div>
                        </div>
                        <div>
                            <div style="font-weight: 600; color: var(--global-palette5); font-size: 13px; margin-bottom: 0.5rem;">éƒµç®±</div>
                            <div style="color: var(--global-palette3); font-size: 15px;">${submission.user_email || '-'}</div>
                        </div>
                        <div>
                            <div style="font-weight: 600; color: var(--global-palette5); font-size: 13px; margin-bottom: 0.5rem;">é–¢ä¿‚é¡å‹</div>
                            <div style="color: var(--global-palette3); font-size: 15px;">${submission.relation_type || '-'}</div>
                        </div>
                        <div>
                            <div style="font-weight: 600; color: var(--global-palette5); font-size: 13px; margin-bottom: 0.5rem;">ç‹€æ…‹</div>
                            <div>${getStatusBadge(submission.status)}</div>
                        </div>
                        <div>
                            <div style="font-weight: 600; color: var(--global-palette5); font-size: 13px; margin-bottom: 0.5rem;">æäº¤æ™‚é–“</div>
                            <div style="color: var(--global-palette3); font-size: 15px;">${formatDate(submission.created_at)}</div>
                        </div>
                    </div>
                    
                    ${submission.content ? `
                    <div style="margin-bottom: 2rem;">
                        <div style="font-weight: 600; color: var(--global-palette5); font-size: 13px; margin-bottom: 0.5rem;">å…§å®¹</div>
                        <div style="padding: 1rem; background: var(--global-palette8); border-radius: 8px; color: var(--global-palette3); white-space: pre-wrap;">${submission.content}</div>
                    </div>
                    ` : ''}
                    
                    ${submission.media_key ? `
                    <div style="margin-bottom: 2rem;">
                        <div style="font-weight: 600; color: var(--global-palette5); font-size: 13px; margin-bottom: 0.5rem;">é™„ä»¶</div>
                        <div style="padding: 1rem; background: var(--global-palette8); border-radius: 8px;">
                            <div style="margin-bottom: 0.5rem;">
                                <strong>æ–‡ä»¶å:</strong> ${submission.media_filename}<br>
                                <strong>å¤§å°:</strong> ${submission.media_size ? (submission.media_size / 1024).toFixed(1) + ' KB' : '-'}<br>
                                <strong>é¡å‹:</strong> ${submission.media_type || '-'}
                            </div>
                            ${isImage ? 
                                `<img src="/api/files/${submission.media_key}" alt="${submission.media_filename}" 
                                      style="max-width: 100%; border-radius: 8px; margin-top: 10px;">` :
                                isVideo ?
                                `<video src="/api/files/${submission.media_key}" controls 
                                        style="max-width: 100%; border-radius: 8px; margin-top: 10px;"></video>` :
                                ''
                            }
                            <div style="margin-top: 10px;">
                                <button onclick="window.open('/api/files/${submission.media_key}')" 
                                        class="btn btn-secondary btn-sm">
                                    ${isImage ? 'ğŸ–¼ï¸ åœ¨æ–°æ¨™ç±¤é æŸ¥çœ‹' : isVideo ? 'ğŸ¬ åœ¨æ–°æ¨™ç±¤é æ’­æ”¾' : 'ğŸ“¥ ä¸‹è¼‰æ–‡ä»¶'}
                                </button>
                            </div>
                        </div>
                    </div>
                    ` : ''}
                    
                    ${submission.notes ? `
                    <div style="margin-bottom: 2rem;">
                        <div style="font-weight: 600; color: var(--global-palette5); font-size: 13px; margin-bottom: 0.5rem;">ç®¡ç†å“¡å‚™è¨»</div>
                        <div style="padding: 1rem; background: #FFF3CD; border-radius: 8px; color: #856404; white-space: pre-wrap;">${submission.notes}</div>
                    </div>
                    ` : ''}
                </div>
                
                <div style="padding: 1.5rem 2rem; border-top: 1px solid var(--global-palette7); display: flex; gap: 1rem; justify-content: flex-end;">
                    ${submission.status === 'pending' ? 
                        `<button class="btn btn-primary" onclick="markAsReviewed(${submission.id}); this.closest('div[style*=fixed]').remove();">æ¨™è¨˜ç‚ºå·²è™•ç†</button>` : 
                        ''
                    }
                    <button class="btn btn-secondary" onclick="this.closest('div[style*=fixed]').remove();">é—œé–‰</button>
                </div>
            </div>
        `;
        
        // Close on background click
        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                modal.remove();
            }
        });
        
        // Close on Escape key
        const handleEscape = (e) => {
            if (e.key === 'Escape') {
                modal.remove();
                document.removeEventListener('keydown', handleEscape);
            }
        };
        document.addEventListener('keydown', handleEscape);
        
        document.body.appendChild(modal);
        
    } catch (error) {
        console.error('View submission error:', error);
        alert('âœ— éŒ¯èª¤: ' + error.message);
    }
}

/**
 * Update submission status (Enhanced)
 */
async function updateSubmissionStatus(submissionId) {
    if (!hasPermission('modifySettings')) {
        showPermissionDenied('è®Šæ›´æäº¤ç‹€æ…‹');
        return;
    }
    
    const newStatus = prompt('é¸æ“‡æ–°ç‹€æ…‹:\n\n- pending (å¾…è™•ç†)\n- reviewed (å·²å¯©æ ¸)\n- resolved (å·²è§£æ±º)\n- archived (å·²æ­¸æª”)', 'reviewed');
    
    if (!newStatus) return;
    
    const validStatuses = ['pending', 'reviewed', 'resolved', 'archived'];
    if (!validStatuses.includes(newStatus)) {
        alert('ç„¡æ•ˆçš„ç‹€æ…‹');
        return;
    }
    
    try {
        const response = await fetch(`/api/submissions/${submissionId}`, {
            method: 'PATCH',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${localStorage.getItem('auth_token')}`
            },
            body: JSON.stringify({
                status: newStatus
            })
        });
        
        const result = await response.json();
        
        if (response.ok && result.success) {
            alert('âœ“ ç‹€æ…‹å·²æ›´æ–°');
            loadSubmissions(); // Reload list
        } else {
            throw new Error(result.error || 'æ›´æ–°å¤±æ•—');
        }
    } catch (error) {
        console.error('Update status error:', error);
        alert('âœ— éŒ¯èª¤: ' + error.message);
    }
}

/**
 * Setup filter change listener
 */
document.getElementById('filter-status')?.addEventListener('change', () => {
    loadSubmissions();
});

// ============================================
// Authentication Functions
// ============================================

/**
 * Logout
 * API Endpoint: POST /api/auth/logout
 */
function handleLogout() {
    if (!confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) {
        return;
    }
    
    // TODO: Implement logout
    // API call example:
    /*
    fetch('/api/auth/logout', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' }
    })
    .then(response => response.json())
    .then(data => {
        console.log('Logged out:', data);
        window.location.href = 'login.html';
    })
    .catch(error => console.error('Error:', error));
    */
    alert('é€€å‡ºç™»å½•\n\nAPI Endpoint: POST /api/auth/logout');
    // Uncomment to redirect to login page:
    // window.location.href = 'login.html';
}

// ============================================
// Initialize
// ============================================

/**
 * Initialize the admin dashboard
 * This function is called when the page loads
 */
async function initializeDashboard() {
    console.log('ğŸš€ Initializing Admin Dashboard...');
    
    // Set debug panel role selector to current role
    const roleSelector = document.getElementById('role-switcher');
    if (roleSelector) {
        roleSelector.value = userRole.toString();
    }
    
    // Check authentication and get user role
    const authResult = await checkAuth();
    
    if (!authResult) {
        console.error('âŒ Authentication failed');
        return;
    }
    
    console.log('âœ“ Admin Dashboard initialized successfully');
    console.log('âœ“ All API endpoints are documented in function comments');
    console.log('âœ“ Permission controls are active');
    console.log('\nğŸ“‹ Quick Reference:');
    console.log('- Change userRole variable (0-2) to test different permission levels');
    console.log('- Use debug panel (bottom-right) to switch roles dynamically');
    console.log('- Uncomment checkAuth() fetch code to integrate with Cloudflare Workers');
    console.log('- All functions have permission checks built-in');
}

// Run initialization when DOM is ready
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initializeDashboard);
} else {
    initializeDashboard();
}
</script>
</body>
</html>
